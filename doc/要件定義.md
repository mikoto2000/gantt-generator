# ガントチャート生成ツール 要件定義

## 1. ツール概要
CSV を唯一の入力形式とし、タスク情報から HTML（純 CSS 使用）のガントチャートを生成する CLI ツール。  
稼働日は月〜金のみとし、依存関係に応じてタスクは自動リスケされる。任意で YAML 形式の祝日リストを非稼働日として読み込める。

---

## 2. 入力仕様（CSV）

### 2.1 列
ヘッダ行から UTF-8 / Shift_JIS を自動判定して読み込む。日付形式は `YYYY-MM-DD` / `YYYY/MM/DD` に加え、月日1桁のゼロ省略（例: `2024-6-3`, `2024/6/3`）も許容。
| 列名        | 型           | 必須 | 説明 |
|-------------|--------------|------|------|
| name        | string       | ✔️   | タスク名（ユニーク） |
| start       | YYYY-MM-DD   |      | 絶対開始日 |
| end         | YYYY-MM-DD   |      | 絶対終了日（単独指定不可） |
| duration    | Nd           |      | 稼働日ベースの期間（例: 5d） |
| depends_on  | string list  |      | 依存タスク名（`,` または `;` 区切り） |
| actual_start | YYYY-MM-DD  |      | 実績開始日（任意、予定の計算には未使用） |
| actual_end  | YYYY-MM-DD   |      | 実績終了日（単独指定不可） |
| actual_duration | Nd       |      | 実績期間（actual_start と併用） |
| 日本語ヘッダ（例）タスク名/開始/終了/期間/依存/実績開始/実績終了/実績期間 | | | 英語ヘッダと同義で使用可能 |

### 2.2 禁止事項
- end のみ指定（startとdurationが空） → エラー
- end と duration の併用 → エラー
- actual_end のみ指定 → エラー
- actual_end と actual_duration の併用 → エラー
- actual_duration のみ指定 → エラー
- name の重複 → エラー
- depends_on が存在しないタスク名を参照 → エラー
- 循環依存 → エラー
- 全フィールド空 → エラー

---

## 3. 稼働日仕様
- 稼働日：**月〜金**
- 土日：非稼働
- 祝日：YAML で指定した場合のみ非稼働
- 開始日が非稼働日の場合は次の稼働日にスライド
- duration は稼働日数としてカウント

---

## 4. スケジューリング仕様

### 4.1 トポロジカルソートを実施し順に確定

### 4.2 開始日
- start がある → 稼働日に調整
- start がなく depends_on がある → 依存タスクの終了日の最大値 + 1 稼働日
- start も depends_on もない → duration のみでは不正（開始決定不可）

### 4.3 終了日
- end 指定あり → そのまま採用（稼働日補正）
- duration 指定あり → start から稼働日ベースで加算

### 4.4 依存関係による強制スライド
絶対 start が指定されていても、依存先が後ろにズレていればスライドする。

---

## 5. タイムライン仕様
- 1日あたりのセル幅：**30px**
- 日付軸：**YYYY-MM-DD（フル表示）**
- タスク名左列：**可変幅**
- タスク名は左列とバー内部の両方に表示

---

## 6. HTML 出力仕様
- CSS は **HTML 内へ `<style>` 埋め込み**
- ガント部は CSS Grid を使用  
  - `grid-template-columns: repeat(N, 30px)`
- 今日の縦線を常に表示する

---

## 7. CLI 仕様
### 実行形式
```
ganttgen <input.csv>
```

### オプション
```
-o, --output         出力 HTML ファイル名（デフォルト: gantt.html）
--holidays           祝日 YAML ファイル（YYYY-MM-DD の配列、または holidays キー配下の配列）
```

### デフォルト出力
```
gantt.html
```

---

## 8. プロジェクト構造（Go）
```
ganttgen/
├── cmd/ganttgen/main.go
├── internal/
│   ├── csvinput/reader.go
│   ├── model/task.go
│   ├── scheduler/scheduler.go
│   ├── calendar/calendar.go
│   └── renderer/{html.go,builder.go}
└── go.mod
```

---

## 9. 実装方針
- CSV → Task → スケジューリング → HTML/CSS（埋め込み）  
の一方向パイプライン
- Go 標準パッケージ中心
- 祝日は YAML による任意指定で対応
